# ============================================
# Risk Radar API Gateway - Production Config
# ============================================
#
# This config is optimized for production deployment.
# Mount this file to /app/config.yaml in the container.
#
# ============================================

server:
  port: 8080
  read_timeout_seconds: 30
  write_timeout_seconds: 30
  idle_timeout_seconds: 120
  upstream_timeout_seconds: 30

jwt:
  algorithm: HS256
  issuer: ""  # Empty for now - user-service doesn't set issuer in tokens
  hmac_secret: "${JWT_ACCESS_SECRET}"

cors:
  # In production with Cloudflare Tunnel, allow the specific origin
  # Cloudflare forwards requests with the original Origin header
  allowed_origins: ["https://riskradar.ovh", "https://www.riskradar.ovh"]
  allowed_methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
  allowed_headers: ["Authorization", "Content-Type", "X-Correlation-ID"]
  allow_credentials: true
  max_age_seconds: 3600

default_rate_limit:
  anonymous: 60
  authenticated: 200

default_upload_max_bytes: 10485760  # 10 MB
json_body_max_bytes: 2097152        # 2 MB

routes:
  # Route all generic /api/* traffic to user-service; specific services override with longer prefixes below
  # This strips only /api, so /api/users/123 becomes /users/123
  - prefix: "/api"
    upstream: "http://user-service:8080"
    auth_required: false
  - prefix: "/api/authz"
    upstream: "http://authz-service:8080"
    auth_required: true
  - prefix: "/api/notifications"
    upstream: "http://notification-service:8080"
    auth_required: true
  - prefix: "/api/reports"
    upstream: "http://report-service:8080"
    auth_required: true
  - prefix: "/api/map"
    upstream: "http://map-service:8080"
    auth_required: false
  - prefix: "/api/media"
    upstream: "http://media-service:8080"
    auth_required: false
    upload_max_bytes: 10485760
  - prefix: "/api/ai/categorization"
    upstream: "http://ai-categorization-service:8080"
    auth_required: true
  - prefix: "/api/ai/verification"
    upstream: "http://ai-verification-duplication-service:8080"
    auth_required: true
  - prefix: "/api/ai/assistant"
    upstream: "http://ai-assistant-service:8080"
    auth_required: true
  - prefix: "/api/audit"
    upstream: "http://audit-log-service:8080"
    auth_required: true
